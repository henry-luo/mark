(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){var falseFunc=require("boolbase").falseFunc;var reChars=/[-[\]{}()*+?.,\\^$|#\s]/g;function factory(adapter){var attributeRules={__proto__:null,equals:function(next,data){var name=data.name,value=data.value;if(data.ignoreCase){value=value.toLowerCase();return function equalsIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.toLowerCase()===value&&next(elem)}}return function equals(elem){return adapter.getAttributeValue(elem,name)===value&&next(elem)}},hyphen:function(next,data){var name=data.name,value=data.value,len=value.length;if(data.ignoreCase){value=value.toLowerCase();return function hyphenIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&(attr.length===len||attr.charAt(len)==="-")&&attr.substr(0,len).toLowerCase()===value&&next(elem)}}return function hyphen(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(0,len)===value&&(attr.length===len||attr.charAt(len)==="-")&&next(elem)}},element:function(next,data){var name=data.name,value=data.value;if(/\s/.test(value)){return falseFunc}value=value.replace(reChars,"\\$&");var pattern="(?:^|\\s)"+value+"(?:$|\\s)",flags=data.ignoreCase?"i":"",regex=new RegExp(pattern,flags);return function element(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&regex.test(attr)&&next(elem)}},exists:function(next,data){var name=data.name;return function exists(elem){return adapter.hasAttrib(elem,name)&&next(elem)}},start:function(next,data){var name=data.name,value=data.value,len=value.length;if(len===0){return falseFunc}if(data.ignoreCase){value=value.toLowerCase();return function startIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(0,len).toLowerCase()===value&&next(elem)}}return function start(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(0,len)===value&&next(elem)}},end:function(next,data){var name=data.name,value=data.value,len=-value.length;if(len===0){return falseFunc}if(data.ignoreCase){value=value.toLowerCase();return function endIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(len).toLowerCase()===value&&next(elem)}}return function end(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.substr(len)===value&&next(elem)}},any:function(next,data){var name=data.name,value=data.value;if(value===""){return falseFunc}if(data.ignoreCase){var regex=new RegExp(value.replace(reChars,"\\$&"),"i");return function anyIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&regex.test(attr)&&next(elem)}}return function any(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.indexOf(value)>=0&&next(elem)}},not:function(next,data){var name=data.name,value=data.value;if(value===""){return function notEmpty(elem){return!!adapter.getAttributeValue(elem,name)&&next(elem)}}else if(data.ignoreCase){value=value.toLowerCase();return function notIC(elem){var attr=adapter.getAttributeValue(elem,name);return attr!=null&&attr.toLowerCase()!==value&&next(elem)}}return function not(elem){return adapter.getAttributeValue(elem,name)!==value&&next(elem)}}};return{compile:function(next,data,options){if(options&&options.strict&&(data.ignoreCase||data.action==="not"))throw new Error("Unsupported attribute selector");return attributeRules[data.action](next,data)},rules:attributeRules}}module.exports=factory},{boolbase:13}],2:[function(require,module,exports){module.exports=compileFactory;var parse=require("./css-what.js"),BaseFuncs=require("boolbase"),sortRules=require("./sort.js"),procedure=require("./procedure.json"),rulesFactory=require("./general.js"),pseudosFactory=require("./pseudos.js"),trueFunc=BaseFuncs.trueFunc,falseFunc=BaseFuncs.falseFunc;function compileFactory(adapter){var Pseudos=pseudosFactory(adapter),filters=Pseudos.filters,Rules=rulesFactory(adapter,Pseudos);function compile(selector,options,context){var next=compileUnsafe(selector,options,context);return wrap(next)}function wrap(next){return function base(elem){return adapter.isTag(elem)&&next(elem)}}function compileUnsafe(selector,options,context){var token=parse(selector,options);return compileToken(token,options,context)}function includesScopePseudo(t){return t.type==="pseudo"&&(t.name==="scope"||Array.isArray(t.data)&&t.data.some(function(data){return data.some(includesScopePseudo)}))}var DESCENDANT_TOKEN={type:"descendant"},FLEXIBLE_DESCENDANT_TOKEN={type:"_flexibleDescendant"},SCOPE_TOKEN={type:"pseudo",name:"scope"},PLACEHOLDER_ELEMENT={};function absolutize(token,context){var hasContext=!!context&&!!context.length&&context.every(function(e){return e===PLACEHOLDER_ELEMENT||!!adapter.getParent(e)});token.forEach(function(t){if(t.length>0&&isTraversal(t[0])&&t[0].type!=="descendant"){}else if(hasContext&&!includesScopePseudo(t)){t.unshift(DESCENDANT_TOKEN)}else{return}t.unshift(SCOPE_TOKEN)})}function compileToken(token,options,context){token=token.filter(function(t){return t.length>0});token.forEach(sortRules);var isArrayContext=Array.isArray(context);context=options&&options.context||context;if(context&&!isArrayContext)context=[context];absolutize(token,context);var shouldTestNextSiblings=false;var query=token.map(function(rules){if(rules[0]&&rules[1]&&rules[0].name==="scope"){var ruleType=rules[1].type;if(isArrayContext&&ruleType==="descendant")rules[1]=FLEXIBLE_DESCENDANT_TOKEN;else if(ruleType==="adjacent"||ruleType==="sibling")shouldTestNextSiblings=true}return compileRules(rules,options,context)}).reduce(reduceRules,falseFunc);query.shouldTestNextSiblings=shouldTestNextSiblings;return query}function isTraversal(t){return procedure[t.type]<0}function compileRules(rules,options,context){return rules.reduce(function(func,rule){if(func===falseFunc)return func;return Rules[rule.type](func,rule,options,context)},options&&options.rootFunc||trueFunc)}function reduceRules(a,b){if(b===falseFunc||a===trueFunc){return a}if(a===falseFunc||b===trueFunc){return b}return function combine(elem){return a(elem)||b(elem)}}function containsTraversal(t){return t.some(isTraversal)}filters.not=function(next,token,options,context){var opts={xmlMode:!!(options&&options.xmlMode),strict:!!(options&&options.strict)};if(opts.strict){if(token.length>1||token.some(containsTraversal)){throw new Error("complex selectors in :not aren't allowed in strict mode")}}var func=compileToken(token,opts,context);if(func===falseFunc)return next;if(func===trueFunc)return falseFunc;return function(elem){return!func(elem)&&next(elem)}};filters.has=function(next,token,options){var opts={xmlMode:!!(options&&options.xmlMode),strict:!!(options&&options.strict)};var context=token.some(containsTraversal)?[PLACEHOLDER_ELEMENT]:null;var func=compileToken(token,opts,context);if(func===falseFunc)return falseFunc;if(func===trueFunc){return function(elem){return adapter.getChildren(elem).some(adapter.isTag)&&next(elem)}}func=wrap(func);if(context){return function has(elem){return next(elem)&&(context[0]=elem,adapter.existsOne(func,adapter.getChildren(elem)))}}return function has(elem){return next(elem)&&adapter.existsOne(func,adapter.getChildren(elem))}};filters.matches=function(next,token,options,context){var opts={xmlMode:!!(options&&options.xmlMode),strict:!!(options&&options.strict),rootFunc:next};return compileToken(token,opts,context)};compile.compileToken=compileToken;compile.compileUnsafe=compileUnsafe;compile.Pseudos=Pseudos;return compile}},{"./css-what.js":3,"./general.js":4,"./procedure.json":6,"./pseudos.js":7,"./sort.js":8,boolbase:13}],3:[function(require,module,exports){"use strict";module.exports=parse;var re_name=/^(?:\\.|[\w\-\u00c0-\uFFFF])+/,re_escape=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,re_attr=/^\s*((?:\\.|[\w\u00c0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])(.*?)\3|(#?(?:\\.|[\w\u00c0-\uFFFF\-])*)|)|)\s*(i)?\]/;var actionTypes={__proto__:null,undefined:"exists","":"equals","~":"element","^":"start",$:"end","*":"any","!":"not","|":"hyphen"};var simpleSelectors={__proto__:null,">":"child","<":"parent","~":"sibling","+":"adjacent"};var attribSelectors={__proto__:null,"#":["id","equals"],".":["class","element"]};var unpackPseudos={__proto__:null,has:true,not:true,matches:true};var stripQuotesFromPseudos={__proto__:null,contains:true,icontains:true};var quotes={__proto__:null,'"':true,"'":true};function funescape(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)}function unescapeCSS(str){return str.replace(re_escape,funescape)}function isWhitespace(c){return c===" "||c==="\n"||c==="\t"||c==="\f"||c==="\r"}function parse(selector,options){var subselects=[];selector=parseSelector(subselects,selector+"",options);if(selector!==""){throw new SyntaxError("Unmatched selector: "+selector)}return subselects}function parseSelector(subselects,selector,options){var tokens=[],sawWS=false,data,firstChar,name,quot;function getName(){var sub=selector.match(re_name)[0];selector=selector.substr(sub.length);return unescapeCSS(sub)}function stripWhitespace(start){while(isWhitespace(selector.charAt(start)))start++;selector=selector.substr(start)}stripWhitespace(0);while(selector!==""){firstChar=selector.charAt(0);if(isWhitespace(firstChar)){sawWS=true;stripWhitespace(1)}else if(firstChar in simpleSelectors){if(firstChar===">"&&selector.charAt(1)===">"){tokens.push({type:"descendant"});stripWhitespace(2)}else{tokens.push({type:simpleSelectors[firstChar]});stripWhitespace(1)}sawWS=false}else if(firstChar===","){if(tokens.length===0){throw new SyntaxError("empty sub-selector")}subselects.push(tokens);tokens=[];sawWS=false;stripWhitespace(1)}else{if(sawWS){if(tokens.length>0){tokens.push({type:"descendant"})}sawWS=false}if(firstChar==="*"){selector=selector.substr(1);tokens.push({type:"universal"})}else if(firstChar in attribSelectors){selector=selector.substr(1);tokens.push({type:"attribute",name:attribSelectors[firstChar][0],action:attribSelectors[firstChar][1],value:getName(),ignoreCase:false})}else if(firstChar==="["){selector=selector.substr(1);data=selector.match(re_attr);if(!data){throw new SyntaxError("Malformed attribute selector: "+selector)}selector=selector.substr(data[0].length);name=unescapeCSS(data[1]);if(!options||("lowerCaseAttributeNames"in options?options.lowerCaseAttributeNames:!options.xmlMode)){name=name.toLowerCase()}tokens.push({type:"attribute",name:name,action:actionTypes[data[2]],value:unescapeCSS(data[4]||data[5]||""),ignoreCase:!!data[6]})}else if(firstChar===":"){if(selector.charAt(1)===":"){selector=selector.substr(2);tokens.push({type:"pseudo-element",name:getName().toLowerCase()});continue}selector=selector.substr(1);name=getName().toLowerCase();data=null;if(selector.charAt(0)==="("){if(name in unpackPseudos){quot=selector.charAt(1);var quoted=quot in quotes;selector=selector.substr(quoted+1);data=[];selector=parseSelector(data,selector,options);if(quoted){if(selector.charAt(0)!==quot){throw new SyntaxError("unmatched quotes in :"+name)}else{selector=selector.substr(1)}}if(selector.charAt(0)!==")"){throw new SyntaxError("missing closing parenthesis in :"+name+" "+selector)}selector=selector.substr(1)}else{var pos=1,counter=1;for(;counter>0&&pos<selector.length;pos++){if(selector.charAt(pos)==="(")counter++;else if(selector.charAt(pos)===")")counter--}if(counter){throw new SyntaxError("parenthesis not matched")}data=selector.substr(1,pos-2);selector=selector.substr(pos);if(name in stripQuotesFromPseudos){quot=data.charAt(0);if(quot===data.slice(-1)&&quot in quotes){data=data.slice(1,-1)}data=unescapeCSS(data)}}}tokens.push({type:"pseudo",name:name,data:data})}else if(re_name.test(selector)){name=getName();if(!options||("lowerCaseTags"in options?options.lowerCaseTags:!options.xmlMode)){name=name.toLowerCase()}tokens.push({type:"tag",name:name})}else{if(tokens.length&&tokens[tokens.length-1].type==="descendant"){tokens.pop()}addToken(subselects,tokens);return selector}}}addToken(subselects,tokens);return selector}function addToken(subselects,tokens){if(subselects.length>0&&tokens.length===0){throw new SyntaxError("empty sub-selector")}subselects.push(tokens)}},{}],4:[function(require,module,exports){var attributeFactory=require("./attributes.js");function generalFactory(adapter,Pseudos){return{__proto__:null,attribute:attributeFactory(adapter).compile,pseudo:Pseudos.compile,tag:function(next,data){var name=data.name;return function tag(elem){return adapter.getName(elem)===name&&next(elem)}},descendant:function(next){return function descendant(elem){var found=false;while(!found&&(elem=adapter.getParent(elem))){found=next(elem)}return found}},_flexibleDescendant:function(next){return function descendant(elem){var found=next(elem);while(!found&&(elem=adapter.getParent(elem))){found=next(elem)}return found}},parent:function(next,data,options){if(options&&options.strict)throw new Error("Parent selector isn't part of CSS3");return function parent(elem){return adapter.getChildren(elem).some(test)};function test(elem){return adapter.isTag(elem)&&next(elem)}},child:function(next){return function child(elem){var parent=adapter.getParent(elem);return!!parent&&next(parent)}},sibling:function(next){return function sibling(elem){var siblings=adapter.getSiblings(elem);for(var i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;if(next(siblings[i]))return true}}return false}},adjacent:function(next){return function adjacent(elem){var siblings=adapter.getSiblings(elem),lastElement;for(var i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;lastElement=siblings[i]}}return!!lastElement&&next(lastElement)}},universal:function(next){return next}}}module.exports=generalFactory},{"./attributes.js":1}],5:[function(require,module,exports){"use strict";module.exports=CSSselect;var falseFunc=require("boolbase").falseFunc,compileFactory=require("./compile.js"),defaultCompile=compileFactory();function getSelectorFunc(searchFunc){return function select(query,elems,options){options=options||{};var compile=compileFactory(options.adapter);if(typeof query!=="function")query=compile.compileUnsafe(query,options,elems);if(query.shouldTestNextSiblings)elems=appendNextSiblings(options&&options.context||elems,options.adapter);if(!Array.isArray(elems))elems=options.adapter.getChildren(elems);else elems=options.adapter.removeSubsets(elems);return searchFunc(query,elems,options)}}function getNextSiblings(elem,adapter){var siblings=adapter.getSiblings(elem);if(!Array.isArray(siblings))return[];siblings=siblings.slice(0);while(siblings.shift()!==elem);return siblings}function appendNextSiblings(elems,adapter){if(!Array.isArray(elems))elems=[elems];var newElems=elems.slice(0);for(var i=0,len=elems.length;i<len;i++){var nextSiblings=getNextSiblings(newElems[i],adapter);newElems.push.apply(newElems,nextSiblings)}return newElems}var selectAll=getSelectorFunc(function selectAll(query,elems,options){return query===falseFunc||!elems||elems.length===0?[]:options.adapter.findAll(query,elems)});var selectOne=getSelectorFunc(function selectOne(query,elems,options){return query===falseFunc||!elems||elems.length===0?null:options.adapter.findOne(query,elems)});function is(elem,query,options){options=options||{};var compile=compileFactory(options.adapter);return(typeof query==="function"?query:compile(query,options))(elem)}function CSSselect(query,elems,options){return selectAll(query,elems,options)}CSSselect.compile=defaultCompile;CSSselect.filters=defaultCompile.Pseudos.filters;CSSselect.pseudos=defaultCompile.Pseudos.pseudos;CSSselect.selectAll=selectAll;CSSselect.selectOne=selectOne;CSSselect.is=is},{"./compile.js":2,boolbase:13}],6:[function(require,module,exports){module.exports={universal:50,tag:30,attribute:1,pseudo:0,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1}},{}],7:[function(require,module,exports){var getNCheck=require("nth-check"),BaseFuncs=require("boolbase"),attributesFactory=require("./attributes.js"),trueFunc=BaseFuncs.trueFunc,falseFunc=BaseFuncs.falseFunc;function filtersFactory(adapter){var attributes=attributesFactory(adapter),checkAttrib=attributes.rules.equals;function equals(a,b){if(typeof adapter.equals==="function")return adapter.equals(a,b);return a===b}function getAttribFunc(name,value){var data={name:name,value:value};return function attribFunc(next){return checkAttrib(next,data)}}function getChildFunc(next){return function(elem){return!!adapter.getParent(elem)&&next(elem)}}var filters={contains:function(next,text){return function contains(elem){return next(elem)&&adapter.getText(elem).indexOf(text)>=0}},icontains:function(next,text){var itext=text.toLowerCase();return function icontains(elem){return next(elem)&&adapter.getText(elem).toLowerCase().indexOf(itext)>=0}},"nth-child":function(next,rule){var func=getNCheck(rule);if(func===falseFunc)return func;if(func===trueFunc)return getChildFunc(next);return function nthChild(elem){var siblings=adapter.getSiblings(elem);for(var i=0,pos=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;else pos++}}return func(pos)&&next(elem)}},"nth-last-child":function(next,rule){var func=getNCheck(rule);if(func===falseFunc)return func;if(func===trueFunc)return getChildFunc(next);return function nthLastChild(elem){var siblings=adapter.getSiblings(elem);for(var pos=0,i=siblings.length-1;i>=0;i--){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;else pos++}}return func(pos)&&next(elem)}},"nth-of-type":function(next,rule){var func=getNCheck(rule);if(func===falseFunc)return func;if(func===trueFunc)return getChildFunc(next);return function nthOfType(elem){var siblings=adapter.getSiblings(elem);for(var pos=0,i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;if(adapter.getName(siblings[i])===adapter.getName(elem))pos++}}return func(pos)&&next(elem)}},"nth-last-of-type":function(next,rule){var func=getNCheck(rule);if(func===falseFunc)return func;if(func===trueFunc)return getChildFunc(next);return function nthLastOfType(elem){var siblings=adapter.getSiblings(elem);for(var pos=0,i=siblings.length-1;i>=0;i--){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)break;if(adapter.getName(siblings[i])===adapter.getName(elem))pos++}}return func(pos)&&next(elem)}},root:function(next){return function(elem){return!adapter.getParent(elem)&&next(elem)}},scope:function(next,rule,options,context){if(!context||context.length===0){return filters.root(next)}if(context.length===1){return function(elem){return equals(context[0],elem)&&next(elem)}}return function(elem){return context.indexOf(elem)>=0&&next(elem)}}};return filters}function pseudosFactory(adapter){function getFirstElement(elems){for(var i=0;elems&&i<elems.length;i++){if(adapter.isTag(elems[i]))return elems[i]}}var pseudos={empty:function(elem){return!adapter.getChildren(elem).some(function(elem){return adapter.isTag(elem)||elem.type==="text"})},"first-child":function(elem){return getFirstElement(adapter.getSiblings(elem))===elem},"last-child":function(elem){var siblings=adapter.getSiblings(elem);for(var i=siblings.length-1;i>=0;i--){if(siblings[i]===elem)return true;if(adapter.isTag(siblings[i]))break}return false},"first-of-type":function(elem){var siblings=adapter.getSiblings(elem);for(var i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)return true;if(adapter.getName(siblings[i])===adapter.getName(elem))break}}return false},"last-of-type":function(elem){var siblings=adapter.getSiblings(elem);for(var i=siblings.length-1;i>=0;i--){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)return true;if(adapter.getName(siblings[i])===adapter.getName(elem))break}}return false},"only-of-type":function(elem){var siblings=adapter.getSiblings(elem);for(var i=0,j=siblings.length;i<j;i++){if(adapter.isTag(siblings[i])){if(siblings[i]===elem)continue;if(adapter.getName(siblings[i])===adapter.getName(elem))return false}}return true},"only-child":function(elem){var siblings=adapter.getSiblings(elem);for(var i=0;i<siblings.length;i++){if(adapter.isTag(siblings[i])&&siblings[i]!==elem)return false}return true}};return pseudos}function verifyArgs(func,name,subselect){if(subselect===null){if(func.length>1&&name!=="scope"){throw new Error("pseudo-selector :"+name+" requires an argument")}}else{if(func.length===1){throw new Error("pseudo-selector :"+name+" doesn't have any arguments")}}}var re_CSS3=/^(?:(?:nth|last|first|only)-(?:child|of-type)|root|empty|(?:en|dis)abled|checked|not)$/;function factory(adapter){var pseudos=pseudosFactory(adapter);var filters=filtersFactory(adapter);return{compile:function(next,data,options,context){var name=data.name,subselect=data.data;if(options&&options.strict&&!re_CSS3.test(name)){throw new Error(":"+name+" isn't part of CSS3")}if(typeof filters[name]==="function"){verifyArgs(filters[name],name,subselect);return filters[name](next,subselect,options,context)}else if(typeof pseudos[name]==="function"){var func=pseudos[name];verifyArgs(func,name,subselect);if(next===trueFunc)return func;return function pseudoArgs(elem){return func(elem,subselect)&&next(elem)}}else{throw new Error("unmatched pseudo-class :"+name)}},filters:filters,pseudos:pseudos}}module.exports=factory},{"./attributes.js":1,boolbase:13,"nth-check":15}],8:[function(require,module,exports){module.exports=sortByProcedure;var procedure=require("./procedure.json");var attributes={__proto__:null,exists:10,equals:8,not:7,start:6,end:6,any:5,hyphen:4,element:4};function sortByProcedure(arr){var procs=arr.map(getProcedure);for(var i=1;i<arr.length;i++){var procNew=procs[i];if(procNew<0)continue;for(var j=i-1;j>=0&&procNew<procs[j];j--){var token=arr[j+1];arr[j+1]=arr[j];arr[j]=token;procs[j+1]=procs[j];procs[j]=procNew}}}function getProcedure(token){var proc=procedure[token.type];if(proc===procedure.attribute){proc=attributes[token.action];if(proc===attributes.equals&&token.name==="id"){proc=9}if(token.ignoreCase){proc>>=1}}else if(proc===procedure.pseudo){if(!token.data){proc=3}else if(token.name==="has"||token.name==="contains"){proc=0}else if(token.name==="matches"||token.name==="not"){proc=0;for(var i=0;i<token.data.length;i++){if(token.data[i].length!==1)continue;var cur=getProcedure(token.data[i][0]);if(cur===0){proc=0;break}if(cur>proc)proc=cur}if(token.data.length>1&&proc>0)proc-=1}else{proc=1}}return proc}},{"./procedure.json":6}],9:[function(require,module,exports){var MarkConvert=function(Mark){let m=Mark;function toMark(elmt,options){if(!elmt)return null;var obj=m(options.format==="xml"?elmt.tagName:elmt.tagName.toLowerCase());if(elmt.hasAttributes()){var attrs=elmt.attributes;for(var i=0;i<attrs.length;i++){var attr=attrs[i];if(attr.specified)obj[attr.name]=attr.value}}if(elmt.hasChildNodes()){for(var i=0;i<elmt.childNodes.length;i++){var child=elmt.childNodes[i];if(child.nodeType===3){if(options.ignoreSpace&&/^\s*$/.test(child.textContent)){}else{obj.push(child.textContent)}}else if(child.nodeType===1){obj.push(toMark(child,options))}else if(child.nodeType===8){obj.push(m.pragma("--"+child.nodeValue,obj))}}}return obj}MarkConvert.parse=function(source,options){if(!options){options={ignoreWhitespace:false}}if(typeof document!=="undefined"){if(source.match(/^\s*(<!doctype|<html)/i)){var parser=new DOMParser;var doc=parser.parseFromString(source,"text/html");return toMark(doc.documentElement,options)}else if(source.match(/^\s*(<\?xml)/i)){var parser=new DOMParser;var doc=parser.parseFromString(source,"text/xml");return toMark(doc.documentElement,options)}else{var doc=document.implementation.createHTMLDocument(null);doc.body.innerHTML=source;var children=doc.body.children;if(!children)return null;if(children.length>1){var result=[];for(var i=0;i<children.length;i++){result.push(toMark(children[i],options))}return result}else{return toMark(doc.body.children[0],options)}}}else{var htmlparser=require("htmlparser2");var parent=[],stack=[];var opt={decodeEntities:true};if(options.format=="xml"){opt.xmlMode=true}var parser=new htmlparser.Parser({onopentag:function(name,attribs){var obj=m(name,attribs,null,parent);if(parent){parent.push(obj);stack.push(parent);parent=obj}else{parent=obj}},ontext:function(text){if(options.ignoreSpace&&/^\s*$/.test(text)){}else{parent.push(text)}},oncomment:function(comment){parent.push(Mark.pragma("--"+comment,parent))},onclosetag:function(tagname){parent=stack.pop()}},opt);parser.write(source.trim());parser.end();return parent.length==1?parent[0]:parent}};var sgmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};var sgmlEscaper=/[&<>"']/g;function escapeStr(str){return(""+str).replace(sgmlEscaper,function(match){return sgmlEscapes[match]})}var emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1};MarkConvert.toSgml=function(object,options){let buffer="",hasSpace=options.space,isXml=options.format==="xml";if(typeof object!=="object"){return null}if(isXml){buffer+='<?xml version="1.0" encoding="UTF-8"?>'}else{if(object.constructor.name=="html"){buffer+="<!DOCTYPE html>"}}function markup(obj,level=0){if(!obj.constructor){let pragma=obj.pragma();buffer+=pragma.indexOf("--",0)===0?"<!"+pragma+"--\x3e":"<?"+pragma+"?>";return}buffer+=(hasSpace?MarkConvert.indent(level):"")+"<"+obj.constructor.name;for(var prop in obj){var value=obj[prop];if(value!=null&&typeof value!=="function"){buffer+=" "+prop+'="'+escapeStr(value)+'"'}}if(isXml&&!obj[0]){buffer+="/>"}else{buffer+=">";let hasElmt=false;for(var item of obj){if(typeof item==="string"){buffer+=escapeStr(item)}else if(typeof item==="object"){markup(item,level+1);hasElmt=true}else{console.trace("unknown object",item)}}if(isXml||!emptyTags[obj.constructor.name]){buffer+=(hasElmt&&hasSpace?MarkConvert.indent(level):"")+"</"+obj.constructor.name+">"}}}markup(object);return buffer};return MarkConvert};if(typeof module==="object")module.exports=MarkConvert},{htmlparser2:"htmlparser2"}],10:[function(require,module,exports){const $parent=Symbol.for("Mark.parent"),$length=Symbol.for("Mark.length");let MarkMutate=function(Mark,pushFunc){let api={push:pushFunc,pop:function(){let length=this[$length];if(length>0){let item=this[length-1];delete this[length-1];this[$length]=length-1;return item}else{return undefined}},splice(index,cnt){if(cnt<0){cnt=0}let len=newlen=this[$length];if(index<0){index=0}else if(index>len){index=len}cnt=Math.min(cnt,len-index);let trailing=len-(index+cnt);if(cnt){for(let i=index;i<index+cnt;i++){delete this[i]}newlen-=cnt}if(arguments.length>2||trailing){let items=Mark("Object");for(let i=2;i<arguments.length;i++){items.push(arguments[i])}if(trailing){for(let i=0;i<trailing;i++){items.push(this[index+cnt+i])}}let extra=Mark.lengthOf(items);if(extra){let i=0;newlen=index+extra;if(typeof items[0]==="string"&&index-1>=0&&typeof this[index-1]==="string"){this[index-1]=this[index-1]+items[0];i++;index--;newlen--}for(;i<extra;i++){Object.defineProperty(this,index+i,{value:items[i],writable:true,configurable:true});if(typeof items[i]==="object"){this[index+i][$parent]=this}}}}if(newlen<len){for(let i=0;i<len-newlen;i++){delete this[newlen+i]}}this[$length]=newlen;return this},set:function(key,value){var index;if(typeof key==="string"){if(isNaN(key*1)){this[key]=value;return this}index=key*1}else if(typeof key==="number"){index=Math.round(key)}else{return this}this.splice(index,1,value);return this}};for(let a in api){Object.defineProperty(Mark.prototype,a,{value:api[a],writable:true,configurable:true})}};module.exports=MarkMutate},{}],11:[function(require,module,exports){const CSSselect=require("./css-select/index.js");function isTag(node){return typeof node==="object"&&node.constructor}function getParent(node){return node.parent()}function getChildren(node){return node[0]?node.contents():[]}const adapter={isTag:isTag,existsOne:function(test,elems){return elems.some(function(elem){return isTag(elem)?test(elem)||adapter.existsOne(test,getChildren(elem)):false})},getAttributeValue:function(elem,name){return elem[name]},getChildren:getChildren,getName:function(elem){return elem.constructor.name},getParent:getParent,getSiblings:function(node){var parent=getParent(node);return parent&&getChildren(parent)},hasAttrib:function(elem,name){return name in elem},findAll:function findAll(test,elems){var result=[];for(var elem of elems){if(!isTag(elem))continue;if(test(elem))result.push(elem);var childs=getChildren(elem);if(childs)result=result.concat(findAll(test,childs))}return result}};let MarkSelector=function(Mark){let api={find:function(selector,options){try{return CSSselect(selector,this,{xmlMode:options&&options.caseSensitive,adapter:adapter})}catch(error){console.error(error);return[]}},matches:function(selector,options){try{return CSSselect.is(this,selector,{xmlMode:options&&options.caseSensitive,adapter:adapter})}catch(error){console.error(error);return false}}};for(let a in api){Object.defineProperty(Mark.prototype,a,{value:api[a],writable:true,configurable:true})}};module.exports=MarkSelector},{"./css-select/index.js":5}],12:[function(require,module,exports){"use strict";const $length=Symbol.for("Mark.length"),_length=Symbol.for("Mark.length-property"),$parent=Symbol.for("Mark.parent"),$isList=Symbol.for("Mark.is-list"),$encoding=Symbol.for("Mark.encoding");const ws=[" ","\t","\r","\n"];let $convert=null,$ctrs={};let MARK=function(){function push(val){let len=this[$length];let t=typeof val;if(t==="string"){if(!val.length)return this;let prevType=len?typeof this[len-1]:null;if(prevType==="string"){len--;val=this[len]+val}}else if(t==="object"){if(val===null)return this;else if(val instanceof Array){if(val[$isList]){for(let v of val){push.call(this,v)}return this}}val[$parent]=this}else if(t==="undefined"){return this}else{}Object.defineProperty(this,len,{value:val,writable:true,configurable:true});this[$length]=len+1;for(let i=1;i<arguments.length;i++){push.call(this,arguments[i])}return this}function Mark(typeName,props,contents){if(arguments.length===1){let char=typeName[0];if(char==="<"||char==="{"||char==="["||char==="("){return MARK.parse(typeName)}else if(!isNameStart(char)){throw"Invalid element name: "+typeName}}if(typeof typeName!=="string"){if(this instanceof Mark){this[$length]=0;return}throw"Type name should be a string"}let con=$ctrs[typeName];if(!con){con=$ctrs[typeName]=function(){};Object.defineProperty(con,"name",{value:typeName,configurable:true});Object.setPrototypeOf(con.prototype,Mark.prototype)}let obj=Object.create(con.prototype);if(props){for(let p in props){if(isNaN(p*1)){obj[p]=props[p]}}}obj[$length]=0;if(contents){if(contents instanceof Array)contents[$isList]=true;push.call(obj,contents)}return obj}let api={contents:function(){let list=[];for(let c of this){list.push(c)}return list},parent:function(pa){return this[$parent]},source:function(options){return MARK.stringify(this,options)},text:function(){let txt=[];let _text=function(obj){for(let n of obj){if(typeof n==="string"){txt.push(n)}else if(n.constructor){_text(n)}}};_text(this);return txt.join("")},html:function(options){let opt=options||{};opt.format="html";return MARK.stringify(this,opt)},xml:function(options){let opt=options||{};opt.format="xml";return MARK.stringify(this,opt)}};let ap=Array.prototype;function wrapped(obj){return Object.create(obj,{length:{value:obj[$length]}})}for(let f of[ap.filter,ap.map,ap.reduce,ap.every,ap.some,ap.forEach,ap.includes,ap.indexOf,ap.lastIndexOf,ap.slice]){api[f.name]=function(){return f.apply(this[_length]!==null?wrapped(this):this,arguments)}}api["each"]=api.forEach;for(let func in api){Object.defineProperty(Mark.prototype,func,{value:api[func],writable:true,configurable:true})}let desc={set:function(value){this[_length]=value;let enumDesc=Object.assign({},desc);enumDesc.enumerable=true;Object.defineProperty(this,"length",enumDesc)},get:function(){return this[_length]!==undefined?this[_length]:this[$length]},configurable:true};Object.defineProperty(Mark.prototype,"length",desc);Mark.prototype[Symbol.iterator]=function*(){let length=this[$length];for(let i=0;i<length;i++){yield this[i]}};Mark.lengthOf=function(obj){return obj==null?null:obj[$length]!==undefined?obj[$length]:obj.length};Mark.parent=function(obj){return obj?obj[Symbol.for("Mark.parent")]:null};Mark.list=function(items){items[$isList]=true;return items};try{require("./lib/mark.selector.js")(Mark)}catch(e){console.trace("No Mark Selector API",e.message)}try{require("./lib/mark.mutate.js")(Mark,push)}catch(e){Object.defineProperty(Mark.prototype,"push",{value:push,writable:true,configurable:true});console.trace("No Mark Mutate API",e.message)}return Mark}();function isNameChar(c){return"a"<=c&&c<="z"||"A"<=c&&c<="Z"||"0"<=c&&c<="9"||c==="_"||c==="$"||c==="."||c==="-"}function isNameStart(c){return"a"<=c&&c<="z"||"A"<=c&&c<="Z"||c==="_"||c==="$"}MARK.isName=function(key){if(typeof key!=="string"){return false}if(!isNameStart(key[0])){return false}var i=1,length=key.length;while(i<length){if(!isNameChar(key[i])){return false}i++}return true};const base64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";MARK.parse=function(){"use strict";let UNEXPECT_END="Unexpected end of input",UNEXPECT_CHAR="Unexpected character ";let at,lineNumber,columnStart,ch,text,escapee={"'":"'",'"':'"',"\\":"\\","/":"/","\n":"",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},renderChar=function(chr){return chr===""?"EOF":"'"+chr+"'"},error=function(m){var columnNumber=at-columnStart;var msg=m+" at line "+lineNumber+" column "+columnNumber+" of the Mark data. Still to read: "+JSON.stringify(text.substring(at-1,at+30)+"...");var error=new SyntaxError(msg);error.at=at;error.lineNumber=lineNumber;error.columnNumber=columnNumber;throw error},next=function(c){if(c&&c!==ch){error("Expected '"+c+"' instead of "+renderChar(ch))}ch=text.charAt(at);at++;if(ch==="\n"||ch==="\r"&&text[at]!=="\n"){lineNumber++;columnStart=at}return ch},identifier=function(){var key=ch;if(ch!=="_"&&ch!=="$"&&(ch<"a"||ch>"z")&&(ch<"A"||ch>"Z")){error(UNEXPECT_CHAR+renderChar(ch))}while(next()&&("a"<=ch&&ch<="z"||"A"<=ch&&ch<="Z"||"0"<=ch&&ch<="9"||ch==="_"||ch==="$")){key+=ch}return key},number=function(){let number,sign="",string="";if(ch==="-"||ch==="+"){sign=ch;next(ch)}if(ch==="i"||ch==="n"){number=word();if(typeof number!=="number"){error("Invalid number")}return sign==="-"?-number:number}if(ch==="0"){string+=ch;next()}else{while(ch>="0"&&ch<="9"){string+=ch;next()}if(ch==="."){string+=".";while(next()&&ch>="0"&&ch<="9"){string+=ch}}if(string===""){error("Invalid number")}if(ch==="n"||ch==="N"){next();return BigInt(string)}else if(ch==="e"||ch==="E"){string+=ch;next();if(ch==="-"||ch==="+"){string+=ch;next()}while(ch>="0"&&ch<="9"){string+=ch;next()}}}if(sign==="-"){number=-string}else{number=+string}return number},_string=function(){var hex,i,string="",delim,uffff;if(ch==='"'||ch==="'"){delim=ch;while(next()){if(ch===delim){next();return string.length?string:null}if(ch==="\\"){next();if(ch==="u"){uffff=0;for(i=0;i<4;i+=1){hex=parseInt(next(),16);if(!isFinite(hex)){break}uffff=uffff*16+hex}string+=String.fromCharCode(uffff)}else if(ch==="\r"){if(text[at]==="\n"){next()}}else if(typeof escapee[ch]==="string"){string+=escapee[ch]}else{break}}else{string+=ch}}}error("Bad string")},string=_string,symbol=function(){let str=_string();return str?Symbol.for(str):null},inlineComment=function(){if(ch!=="/"){error("Not an inline comment")}do{next();if(ch==="\n"||ch==="\r"){next();return}}while(ch)},blockComment=function(){if(ch!=="*"){error("Not a block comment")}do{next();while(ch==="*"){next();if(ch==="/"){next();return}}if(ch==="/"&&text[at]==="*"){next();blockComment()}}while(ch);error("Unterminated block comment")},comment=function(){if(ch!=="/"){error("Not a comment")}next("/");if(ch==="/"){inlineComment()}else if(ch==="*"){blockComment()}else{error("Unrecognized comment")}},white=function(){while(ch){if(ch==="/"){comment()}else if(ws.indexOf(ch)>=0){next()}else{return}}},isSuffix=function(suffix){let len=suffix.length;for(let i=0;i<len;i++){if(text[at+i]!==suffix[i]){return false}}if(isNameStart(text[at+len])){return false}ch=text[at+len];at+=len+1;return true},word=function(){switch(ch){case"b":if(text[at]==="'"){return binary()}break;case"f":if(isSuffix("alse")){return false}break;case"i":if(isSuffix("nf")){return Infinity}break;case"t":if(text[at]==="'"){return datetime()}if(isSuffix("rue")){return true}break;case"n":if(isSuffix("ull")){return null}if(isSuffix("an")){return NaN}break}return identifier()},datetime=function(){at++;next();let start=at-1;let end=text.indexOf("'",start);if(end<0){error("Missing closing quote for datetime")}let dtStr=text.slice(start,end).trim();let timePattern="\\d{2}(?:[:.]\\d{2}(?:[:.]\\d{2}(?:\\.\\d{3})?)?)?";let dtRegex=new RegExp(`^(?:(\\d{4}(?:-\\d{2}(?:-\\d{2})?)?)(?:(?:[Tt]|\\s+)(${timePattern})?)?|(${timePattern}))(?:[zZ]|[+-]\\d{2}:?\\d{2})?$`);let match=dtRegex.exec(dtStr);if(!match){error("Invalid datetime format: "+dtStr)}let datePart=match[1];let datetimeTimePart=match[2];let timeOnlyPart=match[3];let dateOnly=datePart&&!datetimeTimePart&&!timeOnlyPart;let timeOnly=!datePart&&timeOnlyPart;at=end+1;next();let normalizedStr=dtStr;normalizedStr=normalizedStr.replace(/(\d{4}-\d{2}-\d{2})(?:[Tt]|\s+)(\d{2})/,"$1T$2");normalizedStr=normalizedStr.replace(/^(\d{2})([zZ]|[+-]\d{2}:?\d{2})?$/,(match,hour,tz)=>{return hour+":00"+(tz||"")});normalizedStr=normalizedStr.replace(/T(\d{2})([zZ]|[+-]\d{2}:?\d{2})?$/,(match,hour,tz)=>{return"T"+hour+":00"+(tz||"")});normalizedStr=normalizedStr.replace(/([+-])(\d{2})(\d{2})$/,"$1$2:$3");if(timeOnly){normalizedStr="2000-01-01"+"T"+normalizedStr}if(dateOnly){normalizedStr+="T00:00:00"}try{console.log("Parsing datetime: ",normalizedStr);let dateObj=new Date(normalizedStr);if(isNaN(dateObj.getTime())){error("Invalid datetime value: "+dtStr)}dateObj.timeOnly=timeOnly;dateObj.dateOnly=dateOnly;return dateObj}catch(e){error("Invalid datetime: "+e.message)}},value,listPush=function(list,val){let t=typeof val;if(t==="string"){if(!val.length)return;let prevType=list.length?typeof list[list.length-1]:null;if(prevType==="string"){list[list.length-1]+=val;return}}else if(t==="object"){if(val===null)return;else if(val instanceof Array){if(val[$isList]){for(let v of val){listPush(list,v)}return}}val[$parent]=list}else if(t==="undefined"){return}list.push(val)},array=function(){let array=[];let delim=ch==="["?"]":")";next();white();if(ch===delim){next();return delim===")"?null:array}while(ch){let v=value();if(delim===")"){listPush(array,v);console.log("Pushed to list:",v)}else{array.push(v)}if(ch===","){next();white()}else if(ch===delim){next();if(delim===")"){console.log("Parsed list:",array);if(array.length===0){return null}else if(array.length===1){return array[0]}array[$isList]=true}return array}else{error(UNEXPECT_CHAR+renderChar(ch))}}},list=array;let lookup64=new Uint8Array(128);lookup64.fill(65);for(var i=0;i<64;i++){lookup64[base64.charCodeAt(i)]=i}lookup64[32]=lookup64[9]=lookup64[13]=lookup64[10]=64;let binary=function(){at++;if(text[at]!=="\\"){error("Expect '\\'")}at++;if(text[at]==="x"){at++;let end=text.indexOf("'",at),bufEnd=end;if(end<0){error("Missing hex end delimiter")}let hex=new Uint8Array(new ArrayBuffer(bufEnd-at)),p=0;while(at<bufEnd){let code=text.charCodeAt(at);if(code===32||code===9||code===13||code===10){at++;continue}if(code>=48&&code<=57){hex[p++]=code-48}else if(code>=65&&code<=70){hex[p++]=code-55}else if(code>=97&&code<=102){hex[p++]=code-87}else{error("Invalid hex character: "+renderChar(text[at]))}at++}at=end+1;next();if(p%2!==0){error("Invalid hex stream length")}let len=p/2,code1,code2,buffer=new ArrayBuffer(len),bytes=new Uint8Array(buffer);if(len==0){return null}for(let i=0,p=0;p<len;i+=2){code1=hex[i];code2=hex[i+1];if(code1>15||code2>15){error("Invalid hex character")}bytes[p++]=code1<<4|code2}buffer[$encoding]="hex";return buffer}else if(text[at]==="6"&&text[at+1]==="4"){at+=2;let end=text.indexOf("'",at),bufEnd=end,pad=0;if(end<0){error("Missing base64 end delimiter")}if(text[bufEnd-1]==="="){bufEnd--;pad=1;if(text[bufEnd-1]==="="){bufEnd--;pad=2}}let base=new Uint8Array(new ArrayBuffer(bufEnd-at)),p=0;while(at<bufEnd){let code=lookup64[text.charCodeAt(at)];if(code>64){error("Invalid base64 character")}if(code<64){base[p++]=code}at++}at=end+1;next();console.log("base64 char length: ",p,pad);if(pad&&(p+pad)%4!=0||!pad&&p%4==1){error("Invalid base64 stream length")}let len=Math.floor(p*.75),code1,code2,code3,code4,buffer=new ArrayBuffer(len),bytes=new Uint8Array(buffer);if(len==0){return null}for(let i=0,p=0;p<len;i+=4){code1=base[i];code2=base[i+1];code3=base[i+2];code4=base[i+3];bytes[p++]=code1<<2|code2>>4;bytes[p++]=(code2&15)<<4|code3>>2;bytes[p++]=(code3&3)<<6|code4&63}buffer[$encoding]="b64";return buffer}else{error("Invalid binary value")}};let object=function(){let obj,key=null,extended=false,index=0;let putText=function(text){if(index>0&&typeof obj[index-1]==="string"){obj[index-1]+=text}else{Object.defineProperty(obj,index,{value:text,writable:true,configurable:true});index++}},parseContent=function(){while(ch){let needLB=false;if(ch==="<"||ch==="{"){let child=object(obj);Object.defineProperty(obj,index,{value:child,writable:true,configurable:true});child[$parent]=obj;index++}else if(ch==="("||ch==="["){let child=array();if(child){Object.defineProperty(obj,index,{value:child,writable:true,configurable:true});if(typeof child==="object")child[$parent]=obj;index++}needLB=true}else if(ch==='"'){let str=string();if(str)putText(str);needLB=false}else if(ch===">"){next();obj[$length]=index;return}else{let val=value();if(val!=null){Object.defineProperty(obj,index,{value:val,writable:true,configurable:true});index++}needLB=true}if(!needLB){white();if(ch==='"'||ch==="{"||ch==="<"){continue}}while(ch===" "&&ch==="\t"){next()}if(ch===";"||ch==="\n"||ch==="\r"&&text[at]==="\n"){next();white()}else if(ch===">"){}else error(UNEXPECT_CHAR+renderChar(ch))}error(UNEXPECT_END)};let delim=ch==="{"?"}":">";if(ch==="<"){extended=true;delim=">"}else{delim="}"}next();white();if(extended){let ident=ch==="'"?string():identifier();white();obj=MARK(ident,null,null)}else{obj={}}if(ch===delim){next();if(extended){obj[$length]=index}return obj}while(ch){let isSymbol=false,str="";if(ch==='"'||ch==="'"){isSymbol=ch==="'";str=string()}else if(isNameStart(ch)){str=identifier();isSymbol=true}else{if(extended){parseContent();return obj}error(UNEXPECT_CHAR+renderChar(ch))}let hasLB=false;while(ch===" "||ch==="\t"){next()}if(ch==="\n"||ch==="\r"&&text[at]==="\n"){next();white();hasLB=true}if(ch===":"){if(!str){error("Empty key not allowed")}key=str;next()}else{if(extended){if(str){if(isSymbol){Object.defineProperty(obj,index,{value:Symbol.for(str),writable:true,configurable:true});index++;if(ch===";"){next();white()}else if(!hasLB&&ch!==delim){error(UNEXPECT_CHAR+renderChar(ch))}}else{putText(str);if(ch===";"){next();white()}else if(!hasLB&&(ch!=='"'&&ch!=="<"&&ch!=="{"&&ch!==delim)){error(UNEXPECT_CHAR+renderChar(ch))}}}else{error(`Empty ${isSymbol?"symbol":"text"} not allowed`)}parseContent();return obj}error(UNEXPECT_CHAR+renderChar(ch))}var val=value();if(extended&&!isNaN(key*1)){error("Numeric key not allowed as Mark property name")}if(obj[key]&&typeof obj[key]!=="function"){error("Duplicate key not allowed: "+key)}obj[key]=val;hasLB=false;while(ch===" "||ch==="\t"){next()}if(ch==="\n"||ch==="\r"&&text[at]==="\n"){next();white();hasLB=true}if(ch===","){next();white();if(ch===delim){error(UNEXPECT_CHAR+renderChar(ch))}}else if(ch===";"){next();white();parseContent();return obj}else if(ch===delim){next();if(extended){obj[$length]=index}return obj}else if(hasLB){parseContent();return obj}else{error(UNEXPECT_CHAR+renderChar(ch))}}error(UNEXPECT_END)};value=function(){white();switch(ch){case"{":case"<":return object();case"[":return array();case"(":return list();case'"':return string();case"'":return symbol();case"-":case"+":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return number();default:let w=word();return typeof w==="string"?Symbol.for(w):w}};let scanLineBreak=function(){if(ch===";"||ch==="\n"||ch==="\r"&&text[at]==="\n"){next();white();return true}return false};return function(source,options){at=0;lineNumber=1;columnStart=at;ch=" ";text=String(source);if(!source){return null}if(typeof options==="object"&&options.format&&options.format!="mark"){if(!$convert){$convert=require("./lib/mark.convert.js")(MARK)}return $convert.parse(source,options)}let result=[];white();if(!ch){return null}do{let val=value();while(ch===" "||ch==="\t"){next()}if(val!=null){result.push(val);if(typeof val==="object"){if(!(val instanceof Date)||val instanceof ArrayBuffer||Array.isArray(val)){continue}}else if(typeof val==="string"){if(ch==='"'||ch==="<"||ch==="{"){continue}}if(!scanLineBreak()){if(ch)error("Expect ';' or line break")}}}while(ch);if(result.length===0){result=null}else if(result.length===1){result=result[0]}return result}}();MARK.stringify=function(obj,options){"use strict";let indentStep,indentStrs,space;function indent(num,noNewLine){if(num>=indentStrs.length){for(var i=indentStrs.length;i<=num;i++){indentStrs[i]=indentStrs[i-1]+indentStep}}return noNewLine?indentStrs[num]:"\n"+indentStrs[num]}if(options){space=options.space;indentStrs=[""];if(space){if(typeof space==="string"){indentStep=space}else if(typeof space==="number"&&space>=0){indentStep=new Array(space+1).join(" ")}else{indentStep=""}if(indentStep&&indentStep.length>10){indentStep=indentStep.substring(0,10)}}if(options.format&&options.format!=="mark"){if(!$convert){$convert=require("./lib/mark.convert.js")(MARK)}$convert.indent=indent;if(options.format==="xml"||options.format==="html")return $convert.toSgml(obj,options);else return null}}function isDate(obj){return Object.prototype.toString.call(obj)==="[object Date]"}var objStack=[];function checkForCircular(obj){for(var i=0;i<objStack.length;i++){if(objStack[i]===obj){throw new TypeError("Got circular reference")}}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function escapeString(string,isSymbol=false){escapable.lastIndex=0;let delim=isSymbol?"'":'"';return escapable.test(string)?delim+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+delim:delim+string+delim}function _stringify(value){let buffer;if(value&&!isDate(value)){value=value.valueOf()}switch(typeof value){case"boolean":return value.toString();case"number":if(isNaN(value)){return"nan"}else if(!isFinite(value)){return value>0?"inf":"-inf"}return value.toString();case"bigint":return value.toString()+"n";case"string":return escapeString(value.toString());case"symbol":return escapeString(Symbol.keyFor(value),true);case"object":if(value===null){return"null"}else if(Array.isArray(value)){checkForCircular(value);buffer=value[$isList]?"(":"[";objStack.push(value);for(var i=0;i<value.length;i++){let res=_stringify(value[i]);if(indentStep)buffer+=indent(objStack.length);if(res===null||res===undefined){buffer+="null"}else{buffer+=res}if(i<value.length-1){buffer+=", "}else if(indentStep){buffer+="\n"}}objStack.pop();if(value.length&&indentStep){buffer+=indent(objStack.length,true)}buffer+=value[$isList]?")":"]"}else if(value instanceof ArrayBuffer){buffer="b'";if(value[$encoding]==="hex"){buffer+="\\x";let bytes=new Uint8Array(value),i,len=bytes.length;for(i=0;i<len;i++){buffer+=(bytes[i]>>4).toString(16)+(bytes[i]&15).toString(16)}}else{buffer+="\\64";let bytes=new Uint8Array(value),i,fullLen=bytes.length,len=fullLen-fullLen%3;for(i=0;i<len;i+=3){buffer+=base64[bytes[i]>>2];buffer+=base64[(bytes[i]&3)<<4|bytes[i+1]>>4];buffer+=base64[(bytes[i+1]&15)<<2|bytes[i+2]>>6];buffer+=base64[bytes[i+2]&63]}if(fullLen%3){buffer+=base64[bytes[i]>>2]+base64[(bytes[i]&3)<<4|bytes[i+1]>>4]+(fullLen%3===2?base64[(bytes[i+1]&15)<<2]:"=")+"="}}buffer+="'"}else if(value instanceof Date){if(value.timeOnly){buffer="t'"+value.toTimeString().split(" ")[0]+"'"}else if(value.dateOnly){buffer="t'"+value.toISOString().split("T")[0]+"'"}else{buffer="t'"+value.toISOString().replace("T"," ")+"'"}}else{checkForCircular(value);let nonEmpty=false,isElement=false;objStack.push(value);if(value.constructor.name!=="Object"||value instanceof MARK){buffer="<"+value.constructor.name;isElement=true;nonEmpty=true}else{buffer="{"}let hasAttr=false;for(var prop in value){let res=_stringify(value[prop]);if(res!==undefined){let key=MARK.isName(prop)?prop:escapeString(prop,true);buffer+=(hasAttr?", ":nonEmpty?" ":"")+key+":"+res;hasAttr=true;nonEmpty=true}}let length=value[$length];if(length){if(hasAttr){buffer+=";"}for(let i=0;i<length;i++){buffer+=" ";let item=value[i];switch(typeof item){case"string":if(indentStep)buffer+=indent(objStack.length);buffer+=escapeString(item.toString());break;case"symbol":if(indentStep)buffer+=indent(objStack.length);buffer+=escapeString(Symbol.keyFor(item),true);break;case"object":if(indentStep)buffer+=indent(objStack.length);buffer+=_stringify(item);break;case"number":if(indentStep)buffer+=indent(objStack.length);if(isNaN(item)){buffer+="nan"}else if(!isFinite(item)){buffer+=item>0?"inf":"-inf"}else{buffer+=item.toString()}break;case"boolean":if(indentStep)buffer+=indent(objStack.length);buffer+=item.toString();break;default:console.log("Unknown content object",item)}}}objStack.pop();if(nonEmpty){if(length&&indentStep){buffer+=indent(objStack.length)}}buffer+=isElement?">":"}"}return buffer;default:return undefined}}if(obj===undefined){return undefined}return _stringify(obj)};module.exports=MARK;if(typeof window!=="undefined"){window.Mark=MARK}},{"./lib/mark.convert.js":9,"./lib/mark.mutate.js":10,"./lib/mark.selector.js":11}],13:[function(require,module,exports){module.exports={trueFunc:function trueFunc(){return true},falseFunc:function falseFunc(){return false}}},{}],14:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.generate=exports.compile=void 0;var boolbase_1=__importDefault(require("boolbase"));function compile(parsed){var a=parsed[0];var b=parsed[1]-1;if(b<0&&a<=0)return boolbase_1.default.falseFunc;if(a===-1)return function(index){return index<=b};if(a===0)return function(index){return index===b};if(a===1)return b<0?boolbase_1.default.trueFunc:function(index){return index>=b};var absA=Math.abs(a);var bMod=(b%absA+absA)%absA;return a>1?function(index){return index>=b&&index%absA===bMod}:function(index){return index<=b&&index%absA===bMod}}exports.compile=compile;function generate(parsed){var a=parsed[0];var b=parsed[1]-1;var n=0;if(a<0){var aPos_1=-a;var minValue_1=(b%aPos_1+aPos_1)%aPos_1;return function(){var val=minValue_1+aPos_1*n++;return val>b?null:val}}if(a===0)return b<0?function(){return null}:function(){return n++===0?b:null};if(b<0){b+=a*Math.ceil(-b/a)}return function(){return a*n+++b}}exports.generate=generate},{boolbase:13}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sequence=exports.generate=exports.compile=exports.parse=void 0;var parse_js_1=require("./parse.js");Object.defineProperty(exports,"parse",{enumerable:true,get:function(){return parse_js_1.parse}});var compile_js_1=require("./compile.js");Object.defineProperty(exports,"compile",{enumerable:true,get:function(){return compile_js_1.compile}});Object.defineProperty(exports,"generate",{enumerable:true,get:function(){return compile_js_1.generate}});function nthCheck(formula){return(0,compile_js_1.compile)((0,parse_js_1.parse)(formula))}exports.default=nthCheck;function sequence(formula){return(0,compile_js_1.generate)((0,parse_js_1.parse)(formula))}exports.sequence=sequence},{"./compile.js":14,"./parse.js":16}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parse=void 0;var whitespace=new Set([9,10,12,13,32]);var ZERO="0".charCodeAt(0);var NINE="9".charCodeAt(0);function parse(formula){formula=formula.trim().toLowerCase();if(formula==="even"){return[2,0]}else if(formula==="odd"){return[2,1]}var idx=0;var a=0;var sign=readSign();var number=readNumber();if(idx<formula.length&&formula.charAt(idx)==="n"){idx++;a=sign*(number!==null&&number!==void 0?number:1);skipWhitespace();if(idx<formula.length){sign=readSign();skipWhitespace();number=readNumber()}else{sign=number=0}}if(number===null||idx<formula.length){throw new Error("n-th rule couldn't be parsed ('".concat(formula,"')"))}return[a,sign*number];function readSign(){if(formula.charAt(idx)==="-"){idx++;return-1}if(formula.charAt(idx)==="+"){idx++}return 1}function readNumber(){var start=idx;var value=0;while(idx<formula.length&&formula.charCodeAt(idx)>=ZERO&&formula.charCodeAt(idx)<=NINE){value=value*10+(formula.charCodeAt(idx)-ZERO);idx++}return idx===start?null:value}function skipWhitespace(){while(idx<formula.length&&whitespace.has(formula.charCodeAt(idx))){idx++}}}exports.parse=parse},{}]},{},[12]);
